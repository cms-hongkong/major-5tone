<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>音階視覺偵探</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft JhengHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 0 30px rgba(76, 201, 240, 0.2);
            border: 2px solid #4cc9f0;
        }
        
        /* 標題 */
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #4cc9f0;
        }
        
        .subtitle {
            font-size: 1.1rem;
            color: #a9d6e5;
            margin-bottom: 10px;
        }
        
        /* 遊戲狀態 */
        .game-status {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 10px;
        }
        
        @media (max-width: 768px) {
            .game-status {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #a9d6e5;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.8rem;
            color: #f72585;
            font-weight: bold;
        }
        
        /* 問題區 */
        .question-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #4361ee;
            text-align: center;
        }
        
        .question {
            font-size: 1.8rem;
            margin-bottom: 30px;
            color: #a9d6e5;
        }
        
        /* 音階顯示 */
        .scale-display {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin: 25px 0;
        }
        
        .scale-title {
            color: #7209b7;
            font-size: 1.3rem;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .notes-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            margin: 15px 0;
        }
        
        .note {
            width: 60px;
            height: 60px;
            background: linear-gradient(145deg, #4361ee, #3a0ca3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.6rem;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 10px rgba(58, 12, 163, 0.3);
        }
        
        /* 答案選項 */
        .answer-options {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
        }
        
        @media (max-width: 768px) {
            .answer-options {
                flex-direction: column;
                align-items: center;
            }
        }
        
        .option {
            padding: 20px 40px;
            background: linear-gradient(145deg, #1d3557, #457b9d);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1.4rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: bold;
            min-width: 200px;
        }
        
        .option:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .option:active {
            transform: translateY(0);
        }
        
        .option.correct {
            background: linear-gradient(145deg, #2a9d8f, #1d6f5f);
        }
        
        .option.wrong {
            background: linear-gradient(145deg, #e63946, #b92330);
        }
        
        /* 按鈕 */
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 25px;
            font-size: 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            background: linear-gradient(145deg, #4361ee, #3a0ca3);
            color: white;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* 答案顯示 */
        .answer-display {
            margin-top: 20px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            display: none;
        }
        
        .answer-explanation {
            font-size: 1.1rem;
            color: #a9d6e5;
            text-align: center;
        }
        
        /* 遊戲結束 */
        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .game-over-content {
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 600px;
            width: 90%;
            border: 2px solid #4cc9f0;
        }
        
        .final-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        
        .final-stat {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 10px;
        }
        
        .final-stat-value {
            font-size: 2rem;
            color: #4cc9f0;
            font-weight: bold;
        }
        
        /* 響應式 */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .question {
                font-size: 1.5rem;
            }
            
            .note {
                width: 50px;
                height: 50px;
                font-size: 1.4rem;
            }
            
            .option {
                font-size: 1.2rem;
                padding: 15px 30px;
                min-width: 150px;
            }
        }
        
        @media (max-width: 480px) {
            h1 {
                font-size: 1.6rem;
            }
            
            .question {
                font-size: 1.3rem;
            }
            
            .note {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
            }
            
            .option {
                font-size: 1.1rem;
                padding: 12px 20px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 標題 -->
        <header>
            <h1>音階視覺偵探</h1>
            <p class="subtitle">大調音階 vs 五聲音階辨識訓練</p>
            <p class="subtitle">觀察音符組合判斷音階類型</p>
        </header>

        <!-- 遊戲狀態 -->
        <div class="game-status">
            <div class="stat-item">
                <div class="stat-label">關卡</div>
                <div class="stat-value" id="level">1</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">分數</div>
                <div class="stat-value" id="score">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">連擊</div>
                <div class="stat-value" id="combo">0</div>
            </div>
            <div class="stat-item">
                <div class="stat-label">正確</div>
                <div class="stat-value" id="correct">0</div>
            </div>
        </div>

        <!-- 問題區 -->
        <div class="question-section">
            <div class="question" id="question">請問這是什麼音階？</div>
            
            <!-- 音階顯示 -->
            <div class="scale-display">
                <div class="scale-title">顯示的音階</div>
                <div class="notes-container" id="notesDisplay">
                    <!-- 音符由JS生成 -->
                </div>
            </div>

            <!-- 答案選項 -->
            <div class="answer-options">
                <button class="option" data-answer="major">大調音階</button>
                <button class="option" data-answer="pentatonic">五聲音階</button>
            </div>
        </div>

        <!-- 答案顯示 -->
        <div class="answer-display" id="answerDisplay">
            <div class="answer-explanation" id="answerExplanation"></div>
        </div>

        <!-- 按鈕 -->
        <div class="controls">
            <button class="btn" id="nextBtn" disabled>下一題</button>
        </div>
    </div>

    <!-- 遊戲結束 -->
    <div class="game-over" id="gameOver">
        <div class="game-over-content">
            <h2 style="color: #4cc9f0; margin-bottom: 20px;">遊戲完成！</h2>
            <div class="final-stats">
                <div class="final-stat">
                    <div>最終分數</div>
                    <div class="final-stat-value" id="finalScore">0</div>
                </div>
                <div class="final-stat">
                    <div>通過關卡</div>
                    <div class="final-stat-value" id="finalLevel">0</div>
                </div>
                <div class="final-stat">
                    <div>最高連擊</div>
                    <div class="final-stat-value" id="finalCombo">0</div>
                </div>
                <div class="final-stat">
                    <div>正確率</div>
                    <div class="final-stat-value" id="finalAccuracy">0%</div>
                </div>
            </div>
            <div class="controls" style="margin-top: 20px;">
                <button class="btn" id="restartBtn">再玩一次</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 遊戲變數
            let currentLevel = 1;
            let score = 0;
            let combo = 0;
            let maxCombo = 0;
            let gameActive = true;
            let correctCount = 0;
            let totalCount = 0;
            
            // 音階數據
            const scalePatterns = {
                major: {
                    name: "大調音階",
                    // 大調音階5音片段（必須包含Fa或Ti）
                    segments: [
                        // 包含Fa的組合
                        ["Do", "Re", "Mi", "Fa", "Sol"],
                        ["Re", "Mi", "Fa", "Sol", "La"],
                        ["Mi", "Fa", "Sol", "La", "Ti"],
                        ["Fa", "Sol", "La", "Ti", "Do'"],
                        // 包含Ti的組合
                        ["Sol", "La", "Ti", "Do'", "Re'"],
                        ["La", "Ti", "Do'", "Re'", "Mi'"],
                        // 同時包含Fa和Ti的組合
                        ["Do", "Mi", "Fa", "La", "Ti"],
                        ["Re", "Fa", "Sol", "Ti", "Do'"]
                    ]
                },
                pentatonic: {
                    name: "五聲音階",
                    // 五聲音階5音片段（沒有Fa和Ti）
                    segments: [
                        ["Do", "Re", "Mi", "Sol", "La"],
                        ["Re", "Mi", "Sol", "La", "Do'"],
                        ["Mi", "Sol", "La", "Do'", "Re'"],
                        ["Sol", "La", "Do'", "Re'", "Mi'"],
                        ["La", "Do'", "Re'", "Mi'", "Sol'"]
                    ]
                }
            };
            
            // DOM元素
            const levelElement = document.getElementById('level');
            const scoreElement = document.getElementById('score');
            const comboElement = document.getElementById('combo');
            const correctElement = document.getElementById('correct');
            const questionElement = document.getElementById('question');
            const notesDisplayElement = document.getElementById('notesDisplay');
            const answerOptions = document.querySelectorAll('.option');
            const nextBtn = document.getElementById('nextBtn');
            const answerDisplay = document.getElementById('answerDisplay');
            const answerExplanation = document.getElementById('answerExplanation');
            const gameOverElement = document.getElementById('gameOver');
            const finalScoreElement = document.getElementById('finalScore');
            const finalLevelElement = document.getElementById('finalLevel');
            const finalComboElement = document.getElementById('finalCombo');
            const finalAccuracyElement = document.getElementById('finalAccuracy');
            const restartBtn = document.getElementById('restartBtn');
            
            // 初始化遊戲
            initGame();
            
            function initGame() {
                currentLevel = 1;
                score = 0;
                combo = 0;
                maxCombo = 0;
                correctCount = 0;
                totalCount = 0;
                gameActive = true;
                
                updateUI();
                generateQuestion();
                
                answerDisplay.style.display = 'none';
                gameOverElement.style.display = 'none';
            }
            
            function updateUI() {
                levelElement.textContent = currentLevel;
                scoreElement.textContent = score;
                comboElement.textContent = combo;
                correctElement.textContent = correctCount;
            }
            
            function generateQuestion() {
                if (!gameActive) return;
                
                // 隨機選擇音階類型
                const isPentatonic = Math.random() > 0.5;
                const scaleType = isPentatonic ? 'pentatonic' : 'major';
                const scale = scalePatterns[scaleType];
                
                // 從該類型的音階片段中隨機選擇一個
                const segmentIndex = Math.floor(Math.random() * scale.segments.length);
                const displayNotes = scale.segments[segmentIndex];
                
                // 顯示音階（所有音符同色）
                displayScale(displayNotes);
                
                // 儲存正確答案
                window.currentScaleType = scaleType;
                window.currentNotes = displayNotes;
                
                // 重置界面
                resetInterface();
            }
            
            function displayScale(notes) {
                notesDisplayElement.innerHTML = '';
                
                notes.forEach(note => {
                    const noteElement = document.createElement('div');
                    noteElement.className = 'note';
                    noteElement.textContent = note;
                    notesDisplayElement.appendChild(noteElement);
                });
            }
            
            function resetInterface() {
                answerOptions.forEach(btn => {
                    btn.disabled = false;
                    btn.classList.remove('correct', 'wrong');
                });
                
                nextBtn.disabled = true;
                answerDisplay.style.display = 'none';
            }
            
            // 答案檢查
            answerOptions.forEach(btn => {
                btn.addEventListener('click', function() {
                    if (!nextBtn.disabled || !gameActive) return;
                    
                    const selectedAnswer = this.dataset.answer;
                    const isCorrect = selectedAnswer === window.currentScaleType;
                    
                    // 禁用所有答案按鈕
                    answerOptions.forEach(b => b.disabled = true);
                    
                    // 顯示結果
                    if (isCorrect) {
                        this.classList.add('correct');
                        handleCorrectAnswer();
                    } else {
                        this.classList.add('wrong');
                        answerOptions.forEach(b => {
                            if (b.dataset.answer === window.currentScaleType) {
                                b.classList.add('correct');
                            }
                        });
                        handleWrongAnswer();
                    }
                    
                    // 顯示解析
                    showAnswerExplanation();
                    
                    // 啟用下一題按鈕
                    nextBtn.disabled = false;
                    
                    totalCount++;
                    updateUI();
                    
                    // 檢查是否完成遊戲
                    if (totalCount >= 20) {
                        setTimeout(() => gameComplete(), 1000);
                    }
                });
            });
            
            function handleCorrectAnswer() {
                const baseScore = 100;
                const comboBonus = combo * 20;
                const earnedScore = baseScore + comboBonus;
                
                score += earnedScore;
                combo++;
                correctCount++;
                
                if (combo > maxCombo) {
                    maxCombo = combo;
                }
                
                // 每5題升一級
                if (correctCount % 5 === 0 && currentLevel < 10) {
                    currentLevel++;
                }
            }
            
            function handleWrongAnswer() {
                combo = 0;
            }
            
            function showAnswerExplanation() {
                const scaleType = window.currentScaleType;
                const notes = window.currentNotes;
                
                let explanation = '';
                
                if (scaleType === 'major') {
                    // 檢查包含Fa還是Ti
                    const hasFa = notes.some(note => note.includes('Fa'));
                    const hasTi = notes.some(note => note.includes('Ti'));
                    
                    if (hasFa && hasTi) {
                        explanation = '✓ 這是大調音階，因為同時包含 Fa 和 Ti';
                    } else if (hasFa) {
                        explanation = '✓ 這是大調音階，因為包含 Fa';
                    } else if (hasTi) {
                        explanation = '✓ 這是大調音階，因為包含 Ti';
                    }
                } else {
                    explanation = '✓ 這是五聲音階，因為沒有 Fa 和 Ti';
                }
                
                answerExplanation.textContent = explanation;
                answerDisplay.style.display = 'block';
            }
            
            function gameComplete() {
                gameActive = false;
                
                // 計算正確率
                const accuracy = Math.round((correctCount / totalCount) * 100);
                
                // 更新遊戲結束畫面
                finalScoreElement.textContent = score;
                finalLevelElement.textContent = currentLevel;
                finalComboElement.textContent = maxCombo;
                finalAccuracyElement.textContent = `${accuracy}%`;
                
                // 顯示遊戲結束畫面
                gameOverElement.style.display = 'flex';
            }
            
            // 事件監聽器
            nextBtn.addEventListener('click', function() {
                if (gameActive) {
                    generateQuestion();
                }
            });
            
            restartBtn.addEventListener('click', function() {
                gameOverElement.style.display = 'none';
                initGame();
            });
            
            // 初始生成題目
            generateQuestion();
        });
    </script>
</body>
</html>
